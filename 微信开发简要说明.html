<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>微信开发简要说明 | Fed-docs</title>
    <meta name="description" content="Hekr前端文档">
    
    
    <link rel="preload" href="/fed-doc/assets/css/0.styles.79df93a7.css" as="style"><link rel="preload" href="/fed-doc/assets/js/app.e912bd36.js" as="script"><link rel="preload" href="/fed-doc/assets/js/2.03965f8c.js" as="script"><link rel="preload" href="/fed-doc/assets/js/14.d408c93e.js" as="script"><link rel="prefetch" href="/fed-doc/assets/js/10.b8994720.js"><link rel="prefetch" href="/fed-doc/assets/js/11.0ec545d6.js"><link rel="prefetch" href="/fed-doc/assets/js/12.02c16ef5.js"><link rel="prefetch" href="/fed-doc/assets/js/13.6ac43ad1.js"><link rel="prefetch" href="/fed-doc/assets/js/15.4f0d59db.js"><link rel="prefetch" href="/fed-doc/assets/js/16.82f80a83.js"><link rel="prefetch" href="/fed-doc/assets/js/17.f507f9c3.js"><link rel="prefetch" href="/fed-doc/assets/js/18.22dfb34c.js"><link rel="prefetch" href="/fed-doc/assets/js/19.2a3a415d.js"><link rel="prefetch" href="/fed-doc/assets/js/20.aa1492a8.js"><link rel="prefetch" href="/fed-doc/assets/js/21.c70552a9.js"><link rel="prefetch" href="/fed-doc/assets/js/22.f6b81080.js"><link rel="prefetch" href="/fed-doc/assets/js/23.a75caa1c.js"><link rel="prefetch" href="/fed-doc/assets/js/24.43c1f6cd.js"><link rel="prefetch" href="/fed-doc/assets/js/25.9b841371.js"><link rel="prefetch" href="/fed-doc/assets/js/26.468e842a.js"><link rel="prefetch" href="/fed-doc/assets/js/27.6c7a709f.js"><link rel="prefetch" href="/fed-doc/assets/js/28.a52990ba.js"><link rel="prefetch" href="/fed-doc/assets/js/29.f54cd8f7.js"><link rel="prefetch" href="/fed-doc/assets/js/3.253f865d.js"><link rel="prefetch" href="/fed-doc/assets/js/4.4e7ec42f.js"><link rel="prefetch" href="/fed-doc/assets/js/5.80de3d18.js"><link rel="prefetch" href="/fed-doc/assets/js/6.e4efd90d.js"><link rel="prefetch" href="/fed-doc/assets/js/7.a425c80c.js"><link rel="prefetch" href="/fed-doc/assets/js/8.70b491c7.js"><link rel="prefetch" href="/fed-doc/assets/js/9.70ba6f78.js">
    <link rel="stylesheet" href="/fed-doc/assets/css/0.styles.79df93a7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fed-doc/" class="home-link router-link-active"><!----> <span class="site-name">Fed-docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://10.10.1.2:7777/hekr-components/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Hekr-components
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://10.10.1.2:7777/auto/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Auto
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/fed-doc/sdk/" class="nav-link">SDK</a></div><div class="nav-item"><a href="http://10.10.1.2:7777/layer/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  layer
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="http://gitlab.hekr.me/front-end/fed-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitLab
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://10.10.1.2:7777/hekr-components/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Hekr-components
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://10.10.1.2:7777/auto/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Auto
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/fed-doc/sdk/" class="nav-link">SDK</a></div><div class="nav-item"><a href="http://10.10.1.2:7777/layer/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  layer
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="http://gitlab.hekr.me/front-end/fed-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitLab
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>微信开发简要说明</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fed-doc/%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91%E7%AE%80%E8%A6%81%E8%AF%B4%E6%98%8E.html#一、关于openid和unionid" class="sidebar-link">一、关于Openid和UnionID</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/fed-doc/%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91%E7%AE%80%E8%A6%81%E8%AF%B4%E6%98%8E.html#二、如何在微信里登录" class="sidebar-link">二、如何在微信里登录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fed-doc/%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91%E7%AE%80%E8%A6%81%E8%AF%B4%E6%98%8E.html#_2-1-关于access-token和refresh-token" class="sidebar-link">2.1 关于accesstoken和refreshtoken</a></li><li class="sidebar-sub-header"><a href="/fed-doc/%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91%E7%AE%80%E8%A6%81%E8%AF%B4%E6%98%8E.html#_2-2-关于微信的静默授权和非静默授权" class="sidebar-link">2.2 关于微信的静默授权和非静默授权</a></li><li class="sidebar-sub-header"><a href="/fed-doc/%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91%E7%AE%80%E8%A6%81%E8%AF%B4%E6%98%8E.html#_2-3-h5登录流程" class="sidebar-link">2.3 H5登录流程</a></li><li class="sidebar-sub-header"><a href="/fed-doc/%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91%E7%AE%80%E8%A6%81%E8%AF%B4%E6%98%8E.html#_2-4-服务端登录流程" class="sidebar-link">2.4 服务端登录流程</a></li></ul></li><li><a href="/fed-doc/%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91%E7%AE%80%E8%A6%81%E8%AF%B4%E6%98%8E.html#三、前端使用jssdk" class="sidebar-link">三、前端使用JSSDK</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fed-doc/%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91%E7%AE%80%E8%A6%81%E8%AF%B4%E6%98%8E.html#_3-1-关于wx-config权限验证" class="sidebar-link">3.1 关于wx.config权限验证</a></li></ul></li><li><a href="/fed-doc/%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91%E7%AE%80%E8%A6%81%E8%AF%B4%E6%98%8E.html#四、使用微信公众号开发测试" class="sidebar-link">四、使用微信公众号开发测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fed-doc/%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91%E7%AE%80%E8%A6%81%E8%AF%B4%E6%98%8E.html#_4-1-微信测试号配置" class="sidebar-link">4.1 微信测试号配置</a></li><li class="sidebar-sub-header"><a href="/fed-doc/%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91%E7%AE%80%E8%A6%81%E8%AF%B4%E6%98%8E.html#_4-2-微信测试号配置菜单" class="sidebar-link">4.2 微信测试号配置菜单</a></li><li class="sidebar-sub-header"><a href="/fed-doc/%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91%E7%AE%80%E8%A6%81%E8%AF%B4%E6%98%8E.html#_4-3-微信正式号配置" class="sidebar-link">4.3 微信正式号配置</a></li></ul></li><li><a href="/fed-doc/%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91%E7%AE%80%E8%A6%81%E8%AF%B4%E6%98%8E.html#五、微信消息推送" class="sidebar-link">五、微信消息推送</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/fed-doc/%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91%E7%AE%80%E8%A6%81%E8%AF%B4%E6%98%8E.html#六、相关参考" class="sidebar-link">六、相关参考</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="微信开发简要说明"><a href="#微信开发简要说明" aria-hidden="true" class="header-anchor">#</a> 微信开发简要说明</h1> <h2 id="一、关于openid和unionid"><a href="#一、关于openid和unionid" aria-hidden="true" class="header-anchor">#</a> 一、关于Openid和UnionID</h2> <p>一个用户对多个公众号和应用有多个不同的OpenID，但只有一个UnionID。</p> <p>开发前必读 - - <a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421140842" target="_blank" rel="noopener noreferrer">微信网页授权<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="二、如何在微信里登录"><a href="#二、如何在微信里登录" aria-hidden="true" class="header-anchor">#</a> 二、如何在微信里登录</h2> <h3 id="_2-1-关于access-token和refresh-token"><a href="#_2-1-关于access-token和refresh-token" aria-hidden="true" class="header-anchor">#</a> 2.1 关于access_token和refresh_token</h3> <p>使用手机号密码登录，服务端返回access_token和refresh_token，有效期分别为24小时和30天，前端保存至localStorage或者cookie里。用户点击菜单进入页面后</p> <ul><li><p>若access_token存在且有效，则认为已登录；</p></li> <li><p>若access_token存在但失效，但refresh_token有效，则用refresh_token去服务端获取新的access_token；</p></li> <li><p>若access_token、refresh_token不存在或者失效，重新进入手机号密码登录流程。</p></li></ul> <h3 id="_2-2-关于微信的静默授权和非静默授权"><a href="#_2-2-关于微信的静默授权和非静默授权" aria-hidden="true" class="header-anchor">#</a> 2.2 关于微信的静默授权和非静默授权</h3> <p>服务端提供的微信登录接口（例如<a href="http://mock.hekr.me/project/112/interface/api/4225" target="_blank" rel="noopener noreferrer">微信登录<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>），除常用的username、password、clientType、pid外，还有一个code（<a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421140842" target="_blank" rel="noopener noreferrer">微信说明<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>），code由微信对网页进行授权而产生。</p> <p>简要说明，有两种授权方式产生code，一种静默授权，一种非静默授权。</p> <ul><li><p>静默授权微信会自动跳转，用户无感知。H5从url中拿到code，传给服务端，服务端凭此可以拿到openid。</p></li> <li><p>非静默授权的跳转，微信会显示授权页面，需要用户点击按钮才能进行下一步。H5从url中拿到code，传给服务端，服务端凭此可以拿到openid、unionid、微信用户名、微信头像。</p></li></ul> <p>如果服务端不需要“微信用户名”、“微信头像”这些信息，则H5采用静默授权即可。</p> <h3 id="_2-3-h5登录流程"><a href="#_2-3-h5登录流程" aria-hidden="true" class="header-anchor">#</a> 2.3 H5登录流程</h3> <p>下面举例说明。</p> <p>微信公众号菜单里，每一项可配置成一个url地址，一般使用前端地址，SPA同理路由不一样。</p> <ul><li><p>项目管理页面：http://a.cn/project.html</p></li> <li><p>设备管理页面：http://a.cn/device.html</p></li> <li><p>其它功能页面：http://a.cn/xxx.html ....</p></li> <li><p>用户登录页面：http://a.cn/login.html</p></li></ul> <p>登录流程实现可全部放在login.html里。</p> <p>用户点击菜单“项目管理”，微信浏览器进入：</p> <div class="language- extra-class"><pre class="language-text"><code>http://a.cn/project.html
</code></pre></div><p>​	|- - 1）页面检测需要登录，跳转到登录页：</p> <div class="language- extra-class"><pre class="language-text"><code>http://a.cn/login.html?backurl=A

设定 A=urlencode(&quot;http://a.cn/project.html&quot;)
backurl作用是登录后，跳转到原来业务地址。
</code></pre></div><p>​	|- -2）先获取code，跳转到微信授权页面：</p> <div class="language- extra-class"><pre class="language-text"><code>https://open.weixin.qq.com/connect/oauth2/authorize?appid=APPID&amp;redirect_uri=REDIRECT_URI&amp;response_type=code&amp;scope=SCOPE&amp;state=STATE#wechat_redirect

参数说明：
APPID即微信公众号APPID
REDIRECT_URI为当前地址，REDIRECT_URI=urlencode(location.href)
SCOPE，静默用snsapi_base，非静默用snsapi_userinfo。
STATE，为空即可，不是必须。

示例：
https://open.weixin.qq.com/connect/oauth2/authorize?appid=123456&amp;redirect_uri=http%3a%2f%2fa.cn%2flogin.html%3fbackurl%3dhttp%253a%252f%252fa.cn%252fproject.html&amp;response_type=code&amp;scope=snsapi_base&amp;state=#wechat_redirect
</code></pre></div><p>​	|- - 3）微信授权后，跳转回REDIRECT_URI（即第1步中的登录页）：</p> <div class="language- extra-class"><pre class="language-text"><code>http://a.cn/login.html?backurl=A&amp;code=CODE&amp;state=STATE
</code></pre></div><p>​	|- -4） js从url中拿到code，提示用户输入手机号和密码，向后台发起登录请求，后台返回access_token和refresh_token，保存。登录完成，跳转回业务页面A。</p> <div class="language- extra-class"><pre class="language-text"><code>http://a.cn/project.html
</code></pre></div><p>​	|- -5）正常执行业务页面功能。</p> <h3 id="_2-4-服务端登录流程"><a href="#_2-4-服务端登录流程" aria-hidden="true" class="header-anchor">#</a> 2.4 服务端登录流程</h3> <p>服务端登录接口格式例子，参照“标准接口-消防行业产品”</p> <p><a href="http://mock.hekr.me/project/112/interface/api/4225" target="_blank" rel="noopener noreferrer">微信登录<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="http://mock.hekr.me/project/112/interface/api/4270" target="_blank" rel="noopener noreferrer">微信签名<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>服务端收到H5发送的登录请求后，先对用户进行验证，然后根据code向微信服务器获取微信openid或者unionid，并记录到用户数据中。返回access_token和refresh_token。</p> <p>根据code获取微信openid或者unionid，先换取网页授权access_token：</p> <p>注意：此access_token与微信其它地方的access_token无任何关系。</p> <div class="language- extra-class"><pre class="language-text"><code>GET https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&amp;secret=SECRET&amp;code=CODE&amp;grant_type=authorization_code

参数：
APPID和SECRET为公众号信息，CODE即为H5提交的code。

返回：
{ &quot;access_token&quot;:&quot;ACCESS_TOKEN&quot;,
&quot;expires_in&quot;:7200,
&quot;refresh_token&quot;:&quot;REFRESH_TOKEN&quot;,
&quot;openid&quot;:&quot;OPENID&quot;,
&quot;scope&quot;:&quot;SCOPE&quot; }
</code></pre></div><p>若是静默授权，上面接口中即可拿到openid，流程结束。</p> <p>若是非静默授权，需要拿到unionid和微信用户名等信息，继续请求：</p> <div class="language- extra-class"><pre class="language-text"><code>GET https://api.weixin.qq.com/sns/userinfo?access_token=ACCESS_TOKEN&amp;openid=OPENID&amp;lang=zh_CN

参数：
ACCESS_TOKEN和OPENID为上面接口中返回的。

返回：
{    &quot;openid&quot;:&quot; OPENID&quot;,
&quot; nickname&quot;: NICKNAME,
&quot;sex&quot;:&quot;1&quot;,
&quot;province&quot;:&quot;PROVINCE&quot;
&quot;city&quot;:&quot;CITY&quot;,
&quot;country&quot;:&quot;COUNTRY&quot;,
&quot;headimgurl&quot;:&quot;http://thirdwx.qlogo.cn/mmopen/4444/46&quot;,
&quot;privilege&quot;:[ &quot;PRIVILEGE1&quot; &quot;PRIVILEGE2&quot;     ],
&quot;unionid&quot;: &quot;o6_bmasdasdsad6_2sgVt7hMZOPfL&quot;
}
</code></pre></div><p>注意：服务端需要支持一个手机号绑定不同的openid，但只能绑定一个，以最后一个为主。</p> <h2 id="三、前端使用jssdk"><a href="#三、前端使用jssdk" aria-hidden="true" class="header-anchor">#</a> 三、前端使用JSSDK</h2> <p>微信H5开发时，需要用到扫一扫、选图片、位置信息、分享等功能，可以调用JSSDK，具体文档 - - <a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421141115" target="_blank" rel="noopener noreferrer">微信JS-SDK说明文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_3-1-关于wx-config权限验证"><a href="#_3-1-关于wx-config权限验证" aria-hidden="true" class="header-anchor">#</a> 3.1 关于wx.config权限验证</h3> <p>使用JSSDK前，用户需要先登录拿到hekr的access_token。</p> <p>在需要使用JSSDK的页面，引入js文件。</p> <p>所有需要使用JS-SDK的页面必须先注入配置信息，否则将无法调用。每一个url都需要调用一次，包括SPA。</p> <p>js向服务端发起签名请求，<a href="http://mock.hekr.me/project/112/interface/api/4270" target="_blank" rel="noopener noreferrer">微信签名<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language- extra-class"><pre class="language-text"><code>#js注册JSSDK权限
wx.config({
    debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
    appId: '', // 必填，公众号的唯一标识，
    timestamp: , // 必填，生成签名的时间戳
    nonceStr: '', // 必填，生成签名的随机串
    signature: '',// 必填，签名
    jsApiList: [] // 必填，需要使用的JS接口列表
});

参数：
appId、timestamp、nonceStr、signature由签名请求返回。
jsApiList，按需填写，[JS接口列表](https://mp.weixin.qq.com/wiki?action=doc&amp;id=mp1421141115&amp;t=0.9605605998444211&amp;token=&amp;lang=zh_CN#63)
</code></pre></div><h2 id="四、使用微信公众号开发测试"><a href="#四、使用微信公众号开发测试" aria-hidden="true" class="header-anchor">#</a> 四、使用微信公众号开发测试</h2> <h3 id="_4-1-微信测试号配置"><a href="#_4-1-微信测试号配置" aria-hidden="true" class="header-anchor">#</a> 4.1 微信测试号配置</h3> <p>由于公众号需要申请并认证，时间较长，开发测试阶段使用微信测试号，确认无误后再迁移到正式公众号上。</p> <p><a href="https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login&amp;token=&amp;lang=zh_CN" target="_blank" rel="noopener noreferrer">微信测试号<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>  每个人都可以申请测试号，扫码即可使用。测试号拥有正式号的所有功能，且无需单独申请。</p> <p>对应的服务端可以使用生产环境或者预发环境，这里使用预发环境。</p> <p>1）登录 <a href="https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login&amp;token=&amp;lang=zh_CN" target="_blank" rel="noopener noreferrer">微信测试号<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ，获取appID，appsecret，微信号。</p> <p>2）登录test-console.hekr.me -&gt; 产品设计平台 -&gt; 微信控制，将appID、appsecret、微信号配置到对应中，“Token”随机填一字符串，“校验文件名”和“校验文件内容“随便填。记住”Token“和”回调地址“，下一步要使用。</p> <p>3）微信测试号 -&gt; 接口配置信息，将”Token“、”回调地址“填到此。</p> <p>4）微信测试号 -&gt; JS接口安全域名，域名使用本地IP，例如192.168.1.180，不用带端口。确保手机和电脑在同一个网段中，例如都是192或者10开头。</p> <p>5）微信测试号 -&gt; 体验接口权限表 -&gt; 网页服务 -&gt; 网页帐号 -&gt; 修改，域名使用电脑本地IP，例如192.168.1.180:8080，如网页运行在80下，则端口不用带。</p> <p>PC端开发测试可以使用<a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1455784140" target="_blank" rel="noopener noreferrer">微信web开发者工具<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="_4-2-微信测试号配置菜单"><a href="#_4-2-微信测试号配置菜单" aria-hidden="true" class="header-anchor">#</a> 4.2 微信测试号配置菜单</h3> <p>使用<a href="https://mp.weixin.qq.com/debug/cgi-bin/apiinfo" target="_blank" rel="noopener noreferrer">接口调试工具<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>1）先获取access_token</p> <p>2）自定义菜单-自定义菜单创建接口，body参考如下</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;button&quot;: [
        {
            &quot;type&quot;: &quot;view&quot;, 
            &quot;name&quot;: &quot;项目管理&quot;, 
            &quot;url&quot;: &quot;http://192.168.1.180:8080/project.html&quot;
        }, 
        {
            &quot;type&quot;: &quot;view&quot;, 
            &quot;name&quot;: &quot;设备管理&quot;, 
            &quot;url&quot;: &quot;http://192.168.1.180:8080/device.html&quot;
        }, 
        {
            &quot;type&quot;: &quot;view&quot;, 
            &quot;name&quot;: &quot;我的&quot;, 
            &quot;url&quot;: &quot;http://192.168.1.180:8080/login.html&quot;
        }
    ]
}
</code></pre></div><h3 id="_4-3-微信正式号配置"><a href="#_4-3-微信正式号配置" aria-hidden="true" class="header-anchor">#</a> 4.3 微信正式号配置</h3> <p>先申请微信服务号且通过企业认证，才能进行下面步骤。</p> <p>前端项目的线上访问地址一般如下<code>https://hy.hekr.me/abcxxx/wechat/index.html</code></p> <p>1）微信后台 -&gt; 设置 -&gt; 公众号设置 -&gt; 帐号详情，获取原始ID。</p> <p>2）微信后台 -&gt; 设置 -&gt; 公众号设置 -&gt; 功能设置。“JS接口安全域名”、“网页授权域名”填上<code>hy.hekr.me/abcxxx/wechat</code>。下载文件，例如“MP_verify_BlSeZtgK8Ya83gJ1.txt”，将文件集成到前端页面中，保证``https://hy.hekr.me/abcxxx/wechat/MP_verify_BlSeZtgK8Ya83gJ1.txt`可直接访问。</p> <p>3）微信后台 -&gt; 开发 -&gt; 基本配置，获取AppId、AppSecret。</p> <p>4）登录console.hekr.me -&gt; 产品设计平台 -&gt; 微信控制，将AppId、AppSecret、微信号(原始ID)配置到对应中，“Token”随机填一字符串，“校验文件名”、“校验文件内容“填<code>MP_verify_BlSeZtgK8Ya83gJ1.txt</code>及对应内容。记住”Token“和”回调地址“，下一步要使用。</p> <p>5）微信后台 -&gt; 开发 -&gt; 基本配置 -&gt; 服务器配置，将”Token“、”回调地址“填到此，明文模式。</p> <p>6）微信后台 -&gt; 功能 -&gt; 自定义菜单，配置菜单地址。</p> <p>7）微信后台 -&gt; 开发 -&gt; 开发者工具 -&gt; web开发者工具，“开发者微信号”添加前端开发的微信，方便前端开发调试。</p> <p>8）微信后台 -&gt; 设置 -&gt; 人员设置，添加自己为运营者，可避免下次登录微信后台需要管理员扫码。</p> <h2 id="五、微信消息推送"><a href="#五、微信消息推送" aria-hidden="true" class="header-anchor">#</a> 五、微信消息推送</h2> <p>参考<a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1433751277" target="_blank" rel="noopener noreferrer">模板消息接口<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>微信消息无法使用测试号测试，请直接使用正式号。</p> <h2 id="六、相关参考"><a href="#六、相关参考" aria-hidden="true" class="header-anchor">#</a> 六、相关参考</h2> <p><a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1445241432" target="_blank" rel="noopener noreferrer">微信公众平台技术文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> -- 开发必读！</p> <p><a href="https://mp.weixin.qq.com/debug/cgi-bin/apiinfo" target="_blank" rel="noopener noreferrer">微信公众平台接口调试工具<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> — 相当于postman，可获取accesstoken、设置菜单等。</p> <p><a href="https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login&amp;token=&amp;lang=zh_CN" target="_blank" rel="noopener noreferrer">微信测试号<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> — 每个人都可申请，开发测试阶段使用测试号，然后再配置到正式公众号上。</p> <p><a href="http://gitlab.hekr.me/front-end/wechat-login-example" target="_blank" rel="noopener noreferrer">前端开发示例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><div class="edit-link"><a href="http://gitlab.hekr.me/front-end/fed-docs/edit/master/微信开发简要说明.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">10/26/2018, 6:04:58 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/fed-doc/assets/js/app.e912bd36.js" defer></script><script src="/fed-doc/assets/js/2.03965f8c.js" defer></script><script src="/fed-doc/assets/js/14.d408c93e.js" defer></script>
  </body>
</html>
